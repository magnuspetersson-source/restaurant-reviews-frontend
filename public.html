<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recensioner (Local test)</title>
  <link rel="icon" href="data:," />

  <!-- CSS: local with cache-bust -->
  <script>
    (function () {
      const v = Date.now();
      const link = document.createElement("link");
      link.rel = "stylesheet";
      link.href = "./css/public.css?v=" + v;
      document.head.appendChild(link);
      console.log("[RR public] CSS:", link.href);
    })();
  </script>
</head>

<body>
  <div id="app"></div>

  <!-- Blockerande local config (endast lokalt) -->
  <script>
    (function () {
      const host = location.hostname;
      const isLocal = host === "localhost" || host === "127.0.0.1";
      if (!isLocal) return;

      const v = Date.now();
      document.write('<script src="' + location.origin + '/js/config.local.js?v=' + v + '"><\/script>');
      console.log("[RR public] Injected blocking config.local.js");
    })();
  </script>

  <!-- JS loader (local) -->
  <script>
    (function () {
      const host = location.hostname;
      const isLocal = host === "localhost" || host === "127.0.0.1";

      const JS_BASE = isLocal
        ? (location.origin + "/js")
        : "https://magnuspetersson-source.github.io/restaurant-reviews-frontend/js";

      const v = Date.now();

      const files = [
        "config.js",
        "utils/dom.js",
        "utils/format.js",
        "utils/sanitize.js",
        "state.js",
        "router.js",
        "api.js",
        "map/map.js",
        "map/markers.js",
        "ui/list.js",
        "ui/panel.js",
        "ui/comments.js",
        "ui/slideshowModal.js",
        "app.js"
      ];

      function load(i) {
        if (i >= files.length) return;
        const src = JS_BASE + "/" + files[i] + "?v=" + v;
        const s = document.createElement("script");
        s.src = src;
        s.defer = true;
        s.onload = () => load(i + 1);
        s.onerror = () => console.error("[RR public] Missing:", src);
        document.body.appendChild(s);
      }

      console.log("[RR public] JS_BASE:", JS_BASE);
      load(0);
    })();
  </script>
</body>
</html>